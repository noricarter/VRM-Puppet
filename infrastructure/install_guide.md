# VRM Puppet Installation & Usage Guide ðŸŽ­ðŸ›ï¸ðŸ›¡ï¸

Welcome to the VRM Puppet project! This system uses a **Headless Engine** (Python/ComfyUI) and a **Mixer UI** (Browser) synchronized via a **SQLite Authority** database.

## 1. Prerequisites

-   **Python 3.10+**: The core brain of the system.
-   **FFmpeg**: Required for audio conversion (MP3 -> WAV).
-   **Rhubarb Lip-Sync**: Required for viseme generation. (See "Tools" section below).
-   **ComfyUI**: Must be running on port `8188` with the appropriate audio generation workflows.

## 2. Project Architecture

The system is divided into four main regions:
-   `core/`: The "Brain". Handles the bridge, DB management, and media pipeline.
-   `web/`: The "Body". The Three.js viewer and UI controls.
-   `assets/`: The "Soul". VRM models and ComfyUI workflows.
-   `infrastructure/`: Configuration and documentation.

## 3. Installation Steps

### 3.1 Initialize Virtual Environment
```bash
python3 -m venv venv
source venv/bin/activate
pip install -r infrastructure/requirements.txt
```

### 3.2 External Tools Setup
-   **Rhubarb**: Place the `rhubarb` binary in the `bin/` directory at the project root.
-   **FFmpeg**: Ensure `ffmpeg` is in your system PATH.

### 3.3 Database Initialization
The database self-initializes on the first run, but you should seed it with the latest metadata:
```bash
export PYTHONPATH=$PYTHONPATH:$(pwd)/core
python3 tools/ingest_full_authority.py
```

## 4. Usage ðŸš€

### 4.1 Development Mode (Browser Mixer)
To start the full creative suite (Engine, Server, and Browser):
```bash
python3 launch.py
```

### 4.2 Standalone Mode (Transparent HUD)
To launch the character as a transparent overlay on your monitor:
```bash
python3 standalone_app/main.py
```
> [!TIP]
> Use **F8** to toggle the visibility of the character. Use the **â˜°** menu on the right to access settings or quit.

### Manual Controls
-   **Engine**: Runs on `localhost:8001`.
-   **UI Server**: Runs on `localhost:8000`.
-   **Log Monitoring**: Watch the terminal for real-time status updates and ComfyUI feedback.

## 5. Troubleshooting ðŸ› ï¸

### "ComfyUI rejected the prompt"
-   Ensure ComfyUI is running on port `8188`.
-   Verify you have the `vrm_chat (2)` workflow loaded or correctly mapped in the DB.

### No Lip-Sync / Rhubarb Errors
-   Check that `bin/rhubarb` is executable: `chmod +x bin/rhubarb`.
-   Ensure the input audio generated by ComfyUI is valid.

### DB Authority Issues
-   If roles or characters aren't appearing, re-run `tools/ingest_full_authority.py` to refresh the registry.

---
> [!NOTE]
> This system is designed for **persistence**. Your slider settings and chat history are saved in `core/persistence.db` by default.
